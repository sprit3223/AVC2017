#include "E101.h"
#include <stdio.h>

double Q3(){
    take_picture();
    char topPixels[160] = {};
    for (int i=0; i<160; i++){
        topPixels[i] = get_pixel(80, i*2, 3);
    }
    
    char bottomPixels[160] = {};
    for (int i=0; i<160; i++){
        bottomPixels[i] = get_pixel(160, i*2, 3);
    }
    
    int err = 0;
    int topCounter = 0;
    int bottomCounter = 0;
    for (int i=0; i < 160; i++){
        if (topPixels[i] > 127){
            topCounter++;
        }
        if (bottomPixels[i] > 127){
            err += i - 80;
            bottomCounter++;
        }
    }
    
    double reaction;
    double avgErr = err / bottomCounter;
    
    if (topCounter == 0 && bottomCounter == 0){
        reaction = 100;                                 //do a 180
    } else if (avgErr <= -35){                          //may need to tweak for line going left and right
        reaction = 101;                                 //turn left 90
    } else if (avgErr >= 35 && topCounter == 0){
        reaction = 102;                                 //turn right 90
    } else{
        if (err == 0){                                       // go straight and return err to follow line
            reaction = 0;
        } else {
            reaction = avgErr;
        }
    }

    return reaction;
    
}

void main(){
    init();
    
    int motor1;
    int motor2;
    
    double turn = Q3();
    sleep1(0, 100000);
    
    while (____________){                     //until it finds white line or finds first wall of maze
        turn = Q3();
        
        if (turn == 100){
            //do a 180
        
        } else if (turn == 101){
            //turn left 90
        
        } else if (turn == 102){
            // turn right 90
        
        } else{
            double scale = 0.2;                     //need to adjust scale
            motor1 = 30 - (int) (turn * scale);
            motor2 = 30 + (int) (turn * scale);

            set_motor(1, motor1);
            set_motor(2, motor2);

            sleep1(0, 100000);
        
        }
    }
}
    





}
