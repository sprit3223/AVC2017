#include "E101.h"

int move(){
    init();
    
    int motor1;
    int motor2;
    
    double turn = Q2();
    
    sleep1(0, 100000);
    
    while (turn != 100){           
    
        turn = Q2();
        
        if (turn == -100){
            set_motor(1, -80);
            set_motor(2, -80);
            
            sleep1(0, 100000);
        } else {
            double scale = 1;                     //need to adjust scale
            motor1 = 80 - (int) (turn * scale);
            motor2 = 80 + (int) (turn * scale);

            set_motor(1, motor1);
            set_motor(2, motor2);

            sleep1(0, 100000);
        }
    }
    
    set_motor(1, 255);
    set_motor(2, 255);
    return 0;
}

double Q2(){
    take_picture();
    char pixels[160] = {};
    for(int i=0; i<160; i++){
        pixels[i] = get_pixel(120, i*2, 3);
    }

    int err = 0;
    int counter = 0;
    for(int i=0; i < 160; i++){
        if(pixels[i] > 127){
            err += (i - 80);
            counter++;
        }
    }
    
    double avgErr;
    
    if (counter == 0){
        avgErr = -100;
    } else if (counter == 160){
        avgErr = 100;
    } else{
        if (err == 0){                                       // check that err != 0
            avgErr = 0;
        } else {
            avgErr = err / counter;
        }
    }

    return avgErr;
}


